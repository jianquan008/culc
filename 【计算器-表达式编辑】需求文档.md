# 【计算器-表达式编辑】需求文档

## 1. 背景

- 用户在输入过程中经常需要修改表达式中的某个数字或运算符
- 当前只能删除重新输入，效率低下
- 需要支持光标定位和插入编辑功能
- 提升用户输入体验和纠错效率

## 2. 需求

**目标：**为计算器应用添加表达式编辑功能，支持光标移动、插入、删除和选择操作

### 2.1 功能需求

| **功能模块** | **PC端** | **移动端** | **边界条件** |
| ------------ | -------- | ---------- | ------------ |
| 光标定位 | 点击表达式任意位置定位光标 | 点击表达式任意位置定位光标 | 1.光标闪烁显示；2.支持键盘左右键移动；3.Home/End快速定位 |
| 插入编辑 | 在光标位置插入数字或运算符 | 在光标位置插入数字或运算符 | 1.自动验证插入合法性；2.运算符不能连续；3.小数点不能重复 |
| 删除操作 | Backspace删除光标前字符，Delete删除光标后字符 | 长按显示删除按钮 | 1.删除后光标位置保持；2.支持连续删除；3.空表达式时禁用 |
| 文本选择 | 支持鼠标拖拽选择，Shift+方向键选择 | 长按显示选择手柄 | 1.选中文本高亮显示；2.选中后可删除或替换；3.Ctrl+A全选 |

### 2.2 界面需求

**光标样式：**
- 宽度：2px
- 颜色：主题色
- 闪烁频率：1秒/次
- 高度：与字体高度一致

**选择高亮：**
- 背景色：主题色半透明
- 文字颜色：保持原色
- 边框：无
- 圆角：2px

**编辑状态指示：**
- 编辑模式时显示光标
- 非编辑模式时隐藏光标
- 选中文本时显示高亮背景
- 焦点丢失时保存光标位置

### 2.3 交互需求

**光标操作：**
- 点击表达式：光标定位到点击位置
- 左右方向键：光标左右移动
- Home键：光标移到开头
- End键：光标移到末尾
- 双击：选中当前数字或运算符

**编辑操作：**
- 输入数字/运算符：在光标位置插入
- Backspace：删除光标前一个字符
- Delete：删除光标后一个字符
- 选中后输入：替换选中内容
- Ctrl+X：剪切选中内容
- Ctrl+C：复制选中内容
- Ctrl+V：粘贴到光标位置

### 2.4 性能需求

- 光标定位响应时间：≤ 50ms
- 插入/删除操作响应时间：≤ 100ms
- 文本选择流畅度：60fps
- 内存占用增量：≤ 3MB

### 2.5 兼容性需求

- 支持触摸屏设备的长按选择
- 支持键盘和鼠标操作
- 兼容不同屏幕尺寸
- 适配深色和浅色主题

## 3. 验收标准

### 3.1 功能验收
- [ ] 光标定位准确无误
- [ ] 插入编辑功能正常
- [ ] 删除操作符合预期
- [ ] 文本选择和操作正确

### 3.2 性能验收
- [ ] 操作响应速度满足要求
- [ ] 光标闪烁流畅
- [ ] 选择拖拽不卡顿

### 3.3 用户体验验收
- [ ] 光标位置清晰可见
- [ ] 编辑操作符合直觉
- [ ] 错误操作有合适反馈

## 4. 风险评估

**技术风险：**
- 光标位置计算复杂：使用Canvas测量文本宽度
- 移动端选择体验差：提供自定义选择手柄
- 表达式验证复杂：实时验证插入合法性

**用户体验风险：**
- 误触导致光标跳动：增加点击判定区域
- 编辑模式切换不明显：添加视觉指示
